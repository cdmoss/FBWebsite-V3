@page
@model MHFoodBank.Web.Areas.Volunteer.Pages.VolunteerCalendarModel
@using MHFoodBank.Common;
@using MHFoodBank.Common.Dtos;
@using Microsoft.AspNetCore.Antiforgery;
@using Syncfusion.EJ2
@inject IAntiforgery antiForgery
@{
    ViewData["Title"] = "VolunteerCalendar";
    Layout = "~/Areas/Volunteer/Pages/Shared/_Layout.cshtml";
}

<script>
    var shifts;
</script>

@{ 
    var shiftManager = new DataManager
    {
        Adaptor = "UrlAdaptor",
        Url = "VolunteerCalendar?handler=GetShifts",
        CrossDomain = true,
        Headers = new object[] { new { RequestVerificationToken = antiForgery.GetTokens(HttpContext).RequestToken } }
    };

    var positionManager = new DataManager
    {
        Adaptor = "UrlAdaptor",
        Url = "VolunteerCalendar?handler=GetPosition",
        CrossDomain = true,
        Headers = new object[] { new { RequestVerificationToken = antiForgery.GetTokens(HttpContext).RequestToken } }
    };
}

<div style="width: 97%; height: 85vh; margin: auto;">
    <button type="button" onclick="showOpenShifts()">show open shifts</button>
    <button type="button" onclick="showPrivateShifts()">show private shifts</button>
    <ejs-schedule id="schedule" selectedDate="DateTime.Now" width="100%" height="100%" readonly="true" created="initializeDataManager">
        <e-schedule-resources>
            <e-schedule-resource dataSource="Model.Positions" field="PositionId" title="Positions" allowMultiple="false" idField="Id" textField="Name" name="Positions"></e-schedule-resource>
        </e-schedule-resources>
        <e-schedule-eventsettings dataSource="shiftManager"></e-schedule-eventsettings>
    </ejs-schedule>

</div>

<script>
    var dataManager;
    function initializeDataManager() {
        let schedule = document.getElementById('schedule').ej2_instances[0];
        dataManager = schedule.dataModule.dataManager;
    }

     function showOpenShifts() {
        let schedule = document.getElementById('schedule').ej2_instances[0];
        dataManager.executeQuery(new ej.data.Query().addParams('type', 'open')).then(function (e) {
            schedule.eventSettings.dataSource = e.result;
            schedule.dataBind();
        });
         schedule.currentView = "TimelineDay";
         schedule.views = ['TimelineDay', 'TimelineWeek', 'TimelineMonth'];
         schedule.group.resources = ["Positions"];
     }

    function showPrivateShifts() {
        let schedule = document.getElementById('schedule').ej2_instances[0];
        dataManager.executeQuery(new ej.data.Query().addParams('type', 'private')).then(function (e) {
            schedule.eventSettings.dataSource = e.result;
            schedule.dataBind();
        });
        schedule.currentView = "Week";
        schedule.views = ['Day', 'Week', 'Month'];
    }
</script>

@*selectedDate="DateTime.Now" showQuickInfo="false" width="100%" height="100%" popupOpen="onPopupOpen" editorTemplate="#ShiftEditorTemplate" actionBegin="onActionBegin"*@
